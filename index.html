<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="IDES Data Preparation - .NET  : An example of the data preparation process developed using the .NET Framework">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>IDES Data Preparation - .NET </title>
      <script>
  	    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  	    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  	    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  	    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  	    ga('create', 'UA-8154638-5', 'auto');
  	    ga('send', 'pageview');

      </script>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/IRSgov/IDES-Data-Preparation-Dot-Net">View on GitHub</a>

          <h1 id="project_title">IDES Data Preparation - .NET </h1>
          <h2 id="project_tagline">An example of the data preparation process developed using the .NET Framework</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/IRSgov/IDES-Data-Preparation-Dot-Net/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/IRSgov/IDES-Data-Preparation-Dot-Net/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h2>
<a id="ides-data-preparation" class="anchor" href="#ides-data-preparation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>IDES Data Preparation</h2>

<p>The International Data Exchange Service (IDES) is a secure managed file transfer service that allows financial institutions and tax authorities to securely send information on financial accounts held by U.S. taxpayers in accordance with the Foreign Account Tax Compliance Act (FATCA). Files transmitted via IDES must be encrypted and packaged in accordance with published data preparation instructions.  The data preparation process is an important step to ensure that information transmitted via IDES conforms to U.S security standards to safeguard sensitive information.</p>

<p>The IDES Data Preparation.NET project repository demonstrates a sample working application built using <a href="https://www.visualstudio.com/en-us/products/visual-studio-community-vs.aspx">Microsoft Visual Studio 2015 Community edition</a>. The 2013 version of Visual Studio Community works as well.  An application was also developed using Java, see <a href="http://irsgov.github.io/IDES-Data-Preparation-Java">IDES Data Preparation Java</a> for more information.</p>

<p>The example explains how to use the code to develop an application that will create an IDES data packet and decrypt notifications. The project starts with a validated FATCA XML file. The application does not validate the XML or metadata schemas. The sample application will digitally sign, encrypt, compress, and archive the data packet into a compliant .ZIP format.  </p>

<p>Please note that there are many open market tools that produce the same results; however, the IRS does not endorse any commercial products, including the frameworks used in the example.  </p>

<h3>
<a id="create-a-new-project" class="anchor" href="#create-a-new-project" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Create a New Project</h3>

<p><img src="http://irsgov.github.io/IDES-Data-Preparation-Dot-Net/images/img1.png" alt="Image 1"><br>
Figure 1   </p>

<p>Open <strong>Visual Studio</strong>, select <strong>New Project</strong>.   </p>

<p><img src="http://irsgov.github.io/IDES-Data-Preparation-Dot-Net/images/img2.png" alt="Image 2"><br>
Figure 2  </p>

<p>Under <strong>New Project</strong>, select the settings Visual C#, Windows Desktop and Windows Forms Application. Verify the settings, name and location. Click <strong>OK</strong> to continue.  </p>

<h3>
<a id="download-zip-code" class="anchor" href="#download-zip-code" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Download Zip Code</h3>

<p>From this walkthrough, download the .zip file by clicking on the zip folder icon in the upper right of the screen.</p>

<p><img src="http://irsgov.github.io/IDES-Data-Preparation-Dot-Net/images/aug10.png" alt="Image 3"><br>
Figure 3  </p>

<h3>
<a id="extract-zip-contents" class="anchor" href="#extract-zip-contents" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Extract Zip Contents</h3>

<p>The contents of the zip file should be extracted. From the extracted contents, copy the highlighted files and folders below. You will copy these into the new project you just created. You need the Helpers folder, the Form1.cs, Form1.Designer.cs, Form1.resx, and Program.cs files. </p>

<p><img src="http://irsgov.github.io/IDES-Data-Preparation-Dot-Net/images/aug20.png" alt="Image 4"><br>
Figure 4</p>

<p>Open a folder containing the newly created application on your file system. It should look similar to this and have these files. The highlighted files from the .zip extract above should be copied into your application folder.
<img src="http://irsgov.github.io/IDES-Data-Preparation-Dot-Net/images/aug30.png" alt="Image 5"><br>
Figure 5</p>

<p>With the extracted zip files copied into your application folder, it should look similar to this.
<img src="http://irsgov.github.io/IDES-Data-Preparation-Dot-Net/images/aug40.png" alt="Image 6"><br>
Figure 6</p>

<p>When you go back into Visual Studio, you will be prompted to update the solution. Select Yes to All to refresh the solution with the new files.
<img src="http://irsgov.github.io/IDES-Data-Preparation-Dot-Net/images/aug50.png" alt="Image 7"><br>
Figure 7</p>

<p>The updated solution will look like the screen below.
<img src="http://irsgov.github.io/IDES-Data-Preparation-Dot-Net/images/aug60.png" alt="Image 8"><br>
Figure 8</p>

<h3>
<a id="importing-class-files" class="anchor" href="#importing-class-files" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Importing Class Files</h3>

<p>In <strong>Solution Explorer</strong>, add a new folder named <strong>Helpers</strong> that will contain class files or modules for different phases of the application. 
Right click the Project name in the Solution Explorer and select Add --&gt; New Folder. This folder will be named Helpers. 
<img src="http://irsgov.github.io/IDES-Data-Preparation-Dot-Net/images/aug70.png" alt="Image 9"><br>
Figure 9</p>

<p>This shows the newly created Helpers folder.
<img src="http://irsgov.github.io/IDES-Data-Preparation-Dot-Net/images/aug80.png" alt="Image 10"><br>
Figure 10</p>

<p>Add the class files from the Helpers folder into the application. You will need to right click the new Helpers folder and select Add --&gt; Existing Item
<img src="http://irsgov.github.io/IDES-Data-Preparation-Dot-Net/images/aug90.png" alt="Image 11"><br>
Figure 11</p>

<p>Select all 6 of the files in the Helpers folder that is in your new project. You should have all 6 below selected and this will import these into the application.
<img src="http://irsgov.github.io/IDES-Data-Preparation-Dot-Net/images/aug100.png" alt="Image 12"><br>
Figure 12</p>

<p>You should now have a Helpers folder in your project and be able to see the 6 class files within it.
<img src="http://irsgov.github.io/IDES-Data-Preparation-Dot-Net/images/aug110.png" alt="Image 13"><br>
Figure 13</p>

<h3>
<a id="adding-references" class="anchor" href="#adding-references" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Adding References</h3>

<p>Under the Project menu, select the Add Reference option. This will pull up a screen of all references that can be added. 
<img src="http://irsgov.github.io/IDES-Data-Preparation-Dot-Net/images/aug120.png" alt="Image 13"><br>
Figure 13</p>

<p>Next, you will add a reference to the each of the following:</p>

<ul>
<li>System.IO.Compression</li>
<li>System.IO.Compression.FileSystem</li>
<li>System.Security<br>
</li>
<li>WindowsBase</li>
<li>System.Drawing (may already be selected in Visual Studio 2015)
Select the checkbox next to each entry and click <strong>OK</strong>.
<img src="http://irsgov.github.io/IDES-Data-Preparation-Dot-Net/images/aug130.png" alt="Image 14"><br>
Figure 14</li>
</ul>

<h3>
<a id="add-winscp" class="anchor" href="#add-winscp" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Add WinSCP</h3>

<p>From the Tools menu, select the NuGet Package Manager --&gt; Package Manager Console. This may show as the Library Package Manager instead of the NuGet Package Manager in Visual Studio 2013.
<img src="http://irsgov.github.io/IDES-Data-Preparation-Dot-Net/images/aug140.png" alt="Image 15"><br>
Figure 15</p>

<p>This will open the Package Manager Console shown below.
<img src="http://irsgov.github.io/IDES-Data-Preparation-Dot-Net/images/aug150.png" alt="Image 16"><br>
Figure 16</p>

<p>Type “Install-Package WinSCP” in the Console and hit enter.
<img src="http://irsgov.github.io/IDES-Data-Preparation-Dot-Net/images/aug160.png" alt="Image 17"><br>
Figure 17</p>

<p>This will install the WinSCP package. A sucessful installation message should be seen in the Console.
<img src="http://irsgov.github.io/IDES-Data-Preparation-Dot-Net/images/aug170.png" alt="Image 18"><br>
Figure 18</p>

<h3>
<a id="running-application" class="anchor" href="#running-application" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Running Application</h3>

<p>Clicking the start button should now give you the completed application.
<img src="http://irsgov.github.io/IDES-Data-Preparation-Dot-Net/images/aug180.png" alt="Image 19"><br>
Figure 19</p>

<h2>
<a id="create-a-transmission-file" class="anchor" href="#create-a-transmission-file" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Create a Transmission File</h2>

<p>To create a transmission file for IDES, you are required to have (1) an .xml file, (2) a private key that will be used to sign the xml, and (3) the public key of the receiver. The file names are case sensitive and any variation in name, extension or format will cause a transmission failure.  There are no file extensions, unless otherwise noted. For more information, review the IDES User Guide.  </p>

<ol>
<li> Select the Create Data Packet tab</li>
<li> Select the .xml file. The file should be correctly named  to create the correct sender metadata file. For example, Canada (ISO Code = 124) requires a file to be named 000000.00000.TA.124.xml.</li>
<li> Select the sender’s private key. The application uses a <strong>.p12</strong> file that contains the private key. The key may be in a different format, such as a .pfx file.</li>
<li> If there is a password on the key file above, enter it here. </li>
<li> Select the receiver’s public key. This will be the IRS Public Key. This may be in a different format, such as a .cer, .pfx, or .p12 extension.</li>
<li> If there is a password on the public key, enter it here.</li>
<li> Select the Tax Year. This will be used in the metadata file.</li>
</ol>

<p><img src="http://irsgov.github.io/IDES-Data-Preparation-Dot-Net/images/img10.png" alt="Image 20">
Figure 20  </p>

<ol>
<li> Click the <strong>Sign and Encrypt XML</strong> button. If the files and keys are set up correctly, a success message dialog box will appear. Click <strong>OK</strong> to continue.<br>
</li>
</ol>

<p><img src="http://irsgov.github.io/IDES-Data-Preparation-Dot-Net/images/img11.png" alt="Image 21"><br>
Figure 21    </p>

<h3>
<a id="creating-a-zip-file" class="anchor" href="#creating-a-zip-file" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Creating a .ZIP File</h3>

<p>The <strong>Sign and Encrypt XML</strong> button creates a .zip file that contains the key, payload, and sender metadata xml file. The zip filename should follow proper naming conventions and any variation in name, extension or format will cause a transmission failure. For example, the filename is 20150115T174443889Z_000000.00000.TA.124.zip. The contents of the sample .zip file are shown in Figure 12 below.  </p>

<p><img src="http://irsgov.github.io/IDES-Data-Preparation-Dot-Net/images/img12.png" alt="Image 22"><br>
Figure 22  </p>

<p>Next, you are ready to upload the transmission into IDES. For more information on using IDES, review the <a href="http://www.irs.gov/Businesses/Corporations/International-Data-Exchange-Service">IDES User Guide</a>.    </p>

<h2>
<a id="decrypting-a-notification" class="anchor" href="#decrypting-a-notification" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Decrypting a Notification</h2>

<p>The application can be used to decrypt system notifications received in IDES. To decrypt the notification, the receiver must use their private key.  </p>

<ol>
<li> In IDES, download or save the notification to your hard drive.  Select the downloaded .zip notification file.</li>
<li> Select the Decrypt Notification tab.</li>
<li> Select the private key of the receiver. The sample uses a .p12 format; however, the file can be modified for other formats.</li>
<li> If there is a password on the private key, enter it here.</li>
<li> The notification output folder controls the location of the decrypted output.<br>
</li>
<li> Click the <strong>Decrypt Notification</strong> button.<br>
</li>
</ol>

<p><img src="http://irsgov.github.io/IDES-Data-Preparation-Dot-Net/images/img13.png" alt="Image 23"><br>
Figure 23  </p>

<ol>
<li> If the correct key and password (optional) are used on the file, a success message dialog box will appear.<br>
</li>
<li> In the <strong>Notification Output Folder</strong> field, the location of the decrypted and signed xml file that contains the contents of the notification are present. For example, the file name 000000.00000.TA.840_Payload.xml is used in this sample.<br>
</li>
</ol>

<p><img src="http://irsgov.github.io/IDES-Data-Preparation-Dot-Net/images/img14.png" alt="Image 24">
Figure 24  </p>

<h2>
<a id="additional-features" class="anchor" href="#additional-features" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Additional Features</h2>

<p>The repository includes additional documentation that explains how the new SFTP connectivity, schema validation, digital signature validation, and multi-file processing work.</p>

<h3>
<a id="disclaimer" class="anchor" href="#disclaimer" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Disclaimer:</h3>

<p>We waive copyright and related rights in the work worldwide through the CC0 1.0 Universal public domain dedication. Unless expressly stated otherwise, the person who associated a work with this deed makes no warranties about the work, and disclaims liability for all uses of the work, to the fullest extent permitted by applicable law. When using or citing the work, you should not imply endorsement by the author or the affirmer.</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">IDES Data Preparation - .NET  maintained by <a href="https://github.com/IRSgov">IRSgov</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
